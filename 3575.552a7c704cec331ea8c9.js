"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3575],{3575:function(a,e,n){n.r(e),n(7378);var t=n(2682);function s(){return s=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(a[t]=n[t])}return a},s.apply(this,arguments)}function p(a){let{components:e,...n}=a;return(0,t.kt)("wrapper",s({components:e},n),(0,t.kt)("p",null,"如果正在开发一个更加高级的项目，并且需要使用 ",(0,t.kt)("a",{href:"https://www.vagrantup.com/",parentName:"p"},"Vagrant")," 在虚拟机上运行开发环境，那可能会需要在虚拟机中运行 webpack。"),(0,t.kt)("h2",null,(0,t.kt)("span",{id:"configuring-the-project",parentName:"h2"}),"配置项目",(0,t.kt)("a",{href:"#configuring-the-project","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"首先，确保 ",(0,t.kt)("inlineCode",{parentName:"p"},"Vagrantfile")," 拥有一个静态 IP。"),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-ruby",parentName:"pre"},(0,t.kt)("span",{className:"token constant",parentName:"code"},"Vagrant"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"configure",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token string",parentName:"code"},'"2"'),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"do")," ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"|"),"config",(0,t.kt)("span",{className:"token operator",parentName:"code"},"|"),"\n  config",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"vm",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"network ",(0,t.kt)("span",{className:"token symbol",parentName:"code"},":private_network"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," ip",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},'"10.10.10.61"'),"\n",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"end"))),(0,t.kt)("p",null,"然后，在项目中安装 ",(0,t.kt)("inlineCode",{parentName:"p"},"webpack"),"、",(0,t.kt)("inlineCode",{parentName:"p"},"webpack-cli"),"、",(0,t.kt)("inlineCode",{parentName:"p"},"@webpack-cli/serve")," 和 ",(0,t.kt)("inlineCode",{parentName:"p"},"webpack-dev-server"),"："),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-bash",parentName:"pre"},(0,t.kt)("span",{className:"token function",parentName:"code"},"npm")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"install")," --save-dev webpack webpack-cli @webpack-cli/serve webpack-dev-server")),(0,t.kt)("p",null,"创建 ",(0,t.kt)("inlineCode",{parentName:"p"},"webpack.config.js")," 配置文件，下面的示例代码可以作为起步的最简配置："),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-js",parentName:"pre"},"module",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"exports ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  context",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," __dirname",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  entry",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'./app.js'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,t.kt)("p",null,"然后，创建一个 ",(0,t.kt)("inlineCode",{parentName:"p"},"index.html")," 文件。其中的 ",(0,t.kt)("inlineCode",{parentName:"p"},"script")," 标签应当指向 bundle。如果没有在配置中指定 ",(0,t.kt)("inlineCode",{parentName:"p"},"output.filename"),"，其默认值为 ",(0,t.kt)("inlineCode",{parentName:"p"},"bundle.js"),"。"),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-html",parentName:"pre"},(0,t.kt)("span",{className:"token doctype",parentName:"code"},(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"<!"),(0,t.kt)("span",{className:"token doctype-tag",parentName:"span"},"DOCTYPE")," ",(0,t.kt)("span",{className:"token name",parentName:"span"},"html"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},">")),"\n",(0,t.kt)("span",{className:"token tag",parentName:"code"},(0,t.kt)("span",{className:"token tag",parentName:"span"},(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"<"),"html"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},">")),"\n  ",(0,t.kt)("span",{className:"token tag",parentName:"code"},(0,t.kt)("span",{className:"token tag",parentName:"span"},(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"<"),"head"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},">")),"\n    ",(0,t.kt)("span",{className:"token tag",parentName:"code"},(0,t.kt)("span",{className:"token tag",parentName:"span"},(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"<"),"script")," ",(0,t.kt)("span",{className:"token attr-name",parentName:"span"},"src"),(0,t.kt)("span",{className:"token attr-value",parentName:"span"},(0,t.kt)("span",{className:"token punctuation attr-equals",parentName:"span"},"="),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},'"'),"/bundle.js",(0,t.kt)("span",{className:"token punctuation",parentName:"span"},'"'))," ",(0,t.kt)("span",{className:"token attr-name",parentName:"span"},"charset"),(0,t.kt)("span",{className:"token attr-value",parentName:"span"},(0,t.kt)("span",{className:"token punctuation attr-equals",parentName:"span"},"="),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},'"'),"utf-8",(0,t.kt)("span",{className:"token punctuation",parentName:"span"},'"')),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},">")),(0,t.kt)("span",{className:"token script",parentName:"code"}),(0,t.kt)("span",{className:"token tag",parentName:"code"},(0,t.kt)("span",{className:"token tag",parentName:"span"},(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"</"),"script"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},">")),"\n  ",(0,t.kt)("span",{className:"token tag",parentName:"code"},(0,t.kt)("span",{className:"token tag",parentName:"span"},(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"</"),"head"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},">")),"\n  ",(0,t.kt)("span",{className:"token tag",parentName:"code"},(0,t.kt)("span",{className:"token tag",parentName:"span"},(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"<"),"body"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},">")),"\n    ",(0,t.kt)("span",{className:"token tag",parentName:"code"},(0,t.kt)("span",{className:"token tag",parentName:"span"},(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"<"),"h2"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},">")),"Hey!",(0,t.kt)("span",{className:"token tag",parentName:"code"},(0,t.kt)("span",{className:"token tag",parentName:"span"},(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"</"),"h2"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},">")),"\n  ",(0,t.kt)("span",{className:"token tag",parentName:"code"},(0,t.kt)("span",{className:"token tag",parentName:"span"},(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"</"),"body"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},">")),"\n",(0,t.kt)("span",{className:"token tag",parentName:"code"},(0,t.kt)("span",{className:"token tag",parentName:"span"},(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"</"),"html"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},">")))),(0,t.kt)("p",null,"注意，还需要创建一个 ",(0,t.kt)("inlineCode",{parentName:"p"},"app.js")," 文件。"),(0,t.kt)("h2",null,(0,t.kt)("span",{id:"running-the-server",parentName:"h2"}),"启动服务器",(0,t.kt)("a",{href:"#running-the-server","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"现在启动服务器："),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-bash",parentName:"pre"},"webpack serve --host ",(0,t.kt)("span",{className:"token number",parentName:"code"},"0.0"),".0.0 --client-web-socket-url ws://10.10.10.61:8080/ws --watch-options-poll")),(0,t.kt)("p",null,"由于默认只允许从 localhost 访问服务器，所以需要修改 ",(0,t.kt)("inlineCode",{parentName:"p"},"--host")," 参数，以允许在我们的宿主 PC 上访问。"),(0,t.kt)("p",null,(0,t.kt)("inlineCode",{parentName:"p"},"webpack-dev-server")," 会在包中引入一个脚本，此脚本连接到 WebSocket，这样可以在任何文件修改时，触发重新加载应用程序。\n",(0,t.kt)("inlineCode",{parentName:"p"},"--client-web-socket-url")," 标志可以确保脚本知道从哪里查找 WebSocket。默认情况下，服务器会使用 ",(0,t.kt)("inlineCode",{parentName:"p"},"8080")," 端口，因此也需要在这里指定。"),(0,t.kt)("p",null,(0,t.kt)("inlineCode",{parentName:"p"},"--watch-options-poll")," 可以确保 webpack 能够检测到文件更改。webpack 默认会监听文件系统触发的相关事件，但是 VirtualBox 使用默认配置会有许多问题。"),(0,t.kt)("p",null,"现在服务器应该能够通过 ",(0,t.kt)("inlineCode",{parentName:"p"},"http://10.10.10.61:8080")," 访问了。修改 ",(0,t.kt)("inlineCode",{parentName:"p"},"app.js"),"，应用程序就会实时重新加载。"),(0,t.kt)("h2",null,(0,t.kt)("span",{id:"advanced-usage-with-nginx",parentName:"h2"}),"配合 nginx 的高级用法",(0,t.kt)("a",{href:"#advanced-usage-with-nginx","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"为了更好的模拟类生产环境，可以使用 nginx 来代理 ",(0,t.kt)("inlineCode",{parentName:"p"},"webpack-dev-server"),"。"),(0,t.kt)("p",null,"在 nginx 配置文件中，加入下面代码："),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-nginx",parentName:"pre"},(0,t.kt)("span",{className:"token keyword",parentName:"code"},"server")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"location")," ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"/")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"proxy_pass")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"http"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},":"),(0,t.kt)("span",{className:"token operator",parentName:"code"},"/"),(0,t.kt)("span",{className:"token operator",parentName:"code"},"/"),(0,t.kt)("span",{className:"token number",parentName:"code"},"127.0"),(0,t.kt)("span",{className:"token number",parentName:"code"},".0"),(0,t.kt)("span",{className:"token number",parentName:"code"},".1"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},":"),(0,t.kt)("span",{className:"token number",parentName:"code"},"8080"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n    ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"proxy_http_version")," ",(0,t.kt)("span",{className:"token number",parentName:"code"},"1.1"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n    ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"proxy_set_header")," Upgrade ",(0,t.kt)("span",{className:"token variable",parentName:"code"},"$http_upgrade"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n    ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"proxy_set_header")," Connection ",(0,t.kt)("span",{className:"token string",parentName:"code"},'"upgrade"'),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n    ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"error_page")," ",(0,t.kt)("span",{className:"token number",parentName:"code"},"502")," @start",(0,t.kt)("span",{className:"token operator",parentName:"code"},"-"),"webpack",(0,t.kt)("span",{className:"token operator",parentName:"code"},"-"),"dev",(0,t.kt)("span",{className:"token operator",parentName:"code"},"-"),(0,t.kt)("span",{className:"token keyword",parentName:"code"},"server"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),"\n\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"location")," @start",(0,t.kt)("span",{className:"token operator",parentName:"code"},"-"),"webpack",(0,t.kt)("span",{className:"token operator",parentName:"code"},"-"),"dev",(0,t.kt)("span",{className:"token operator",parentName:"code"},"-"),(0,t.kt)("span",{className:"token keyword",parentName:"code"},"server")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"default_type")," text",(0,t.kt)("span",{className:"token operator",parentName:"code"},"/"),"plain",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n    ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"return")," ",(0,t.kt)("span",{className:"token number",parentName:"code"},"502")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},'"Please start the webpack-dev-server first."'),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"))),(0,t.kt)("p",null,(0,t.kt)("inlineCode",{parentName:"p"},"proxy_set_header")," 这几行配置很重要，因为它们能够使 WebSocket 正常运行。"),(0,t.kt)("p",null,"然后 ",(0,t.kt)("inlineCode",{parentName:"p"},"webpack-dev-server")," 启动命令可以修改为："),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-bash",parentName:"pre"},"webpack serve --client-web-socket-url ws://10.10.10.61:8080/ws --watch-options-poll")),(0,t.kt)("p",null,"现在只能通过 ",(0,t.kt)("inlineCode",{parentName:"p"},"127.0.0.1")," 访问服务，不过这并不影响，因为 ngnix 已经能够支持 PC 电脑访问到服务器。"),(0,t.kt)("h2",null,(0,t.kt)("span",{id:"conclusion",parentName:"h2"}),"总结",(0,t.kt)("a",{href:"#conclusion","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"我们能够从静态 IP 访问 VagrantBox，然后使 ",(0,t.kt)("inlineCode",{parentName:"p"},"webpack-dev-server")," 可以公开访问，以便浏览器可以访问到它。最后解决了 VirtualBox 不发送到文件系统事件的常见问题，此问题会导致服务器无法重新加载文件更改。"))}p.isMDXComponent=!0,e.default=p}}]);