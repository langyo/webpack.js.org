"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[242],{242:function(a,e,n){n.r(e),n(7378);var t=n(2682);function s(){return s=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(a[t]=n[t])}return a},s.apply(this,arguments)}function p(a){let{components:e,...n}=a;return(0,t.kt)("wrapper",s({components:e},n),(0,t.kt)("p",null,"loader 是导出为一个函数的 node 模块。该函数在 loader 转换资源的时候调用。给定的函数将调用 ",(0,t.kt)("a",{href:"/api/loaders/",parentName:"p"},"Loader API"),"，并通过 ",(0,t.kt)("inlineCode",{parentName:"p"},"this")," 上下文访问。"),(0,t.kt)("h2",null,(0,t.kt)("span",{id:"setup",parentName:"h2"}),"设置",(0,t.kt)("a",{href:"#setup","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"在深入研究不同 loader 以及他们的用法和例子之前，我们先看三种本地开发测试的方法。"),(0,t.kt)("p",null,"匹配（test）单个 loader，你可以通过在 rule 对象使用 ",(0,t.kt)("inlineCode",{parentName:"p"},"path.resolve")," 指定一个本地文件："),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"webpack.config.js")),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-js",parentName:"pre"},(0,t.kt)("span",{className:"token keyword",parentName:"code"},"const")," path ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"require"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token string",parentName:"code"},"'path'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\nmodule",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"exports ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,t.kt)("span",{className:"token comment",parentName:"code"},"//..."),"\n  module",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    rules",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"["),"\n      ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n        test",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token regex",parentName:"code"},"/\\.js$/"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n        use",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"["),"\n          ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n            loader",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," path",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"resolve"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token string",parentName:"code"},"'path/to/loader.js'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n            options",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n              ",(0,t.kt)("span",{className:"token comment",parentName:"code"},"/* ... */"),"\n            ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n          ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n        ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n      ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,t.kt)("p",null,"匹配（test）多个 loaders，你可以使用 ",(0,t.kt)("inlineCode",{parentName:"p"},"resolveLoader.modules")," 配置，webpack 将会从这些目录中搜索这些 loaders。例如，如果你的项目中有一个 ",(0,t.kt)("inlineCode",{parentName:"p"},"/loaders")," 本地目录："),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"webpack.config.js")),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-js",parentName:"pre"},(0,t.kt)("span",{className:"token keyword",parentName:"code"},"const")," path ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"require"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token string",parentName:"code"},"'path'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\nmodule",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"exports ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,t.kt)("span",{className:"token comment",parentName:"code"},"//..."),"\n  resolveLoader",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    modules",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"["),(0,t.kt)("span",{className:"token string",parentName:"code"},"'node_modules'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," path",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"resolve"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"__dirname",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'loaders'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,t.kt)("p",null,"顺便提一下，如果你已经为 loader 创建了独立的库和包，你可以使用 ",(0,t.kt)("a",{href:"https://docs.npmjs.com/cli/link",parentName:"p"},(0,t.kt)("inlineCode",{parentName:"a"},"npm link"))," 来将其链接到你要测试的项目。"),(0,t.kt)("aside",{className:"tip"},(0,t.kt)("h6",{className:"tip__prefix",parentName:"aside"},"提示"),(0,t.kt)("p",{parentName:"aside"},"你可以用 ",(0,t.kt)("a",{href:"https://github.com/webpack-contrib/webpack-defaults",parentName:"p"},(0,t.kt)("inlineCode",{parentName:"a"},"webpack-defaults")," package")," 来生成开始编写 loader 必要的样板代码(boilerplate code)。")),(0,t.kt)("h2",null,(0,t.kt)("span",{id:"simple-usage",parentName:"h2"}),"简单用法",(0,t.kt)("a",{href:"#simple-usage","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"当一个 loader 在资源中使用，这个 loader 只能传入一个参数 - 一个包含资源文件内容的字符串。"),(0,t.kt)("p",null,"同步 loader 可以 ",(0,t.kt)("inlineCode",{parentName:"p"},"return")," 一个代表已转换模块（transformed module）的单一值。在更复杂的情况下，loader 也可以通过使用 ",(0,t.kt)("inlineCode",{parentName:"p"},"this.callback(err, values...)")," 函数，返回任意数量的值。错误要么传递给这个 ",(0,t.kt)("inlineCode",{parentName:"p"},"this.callback")," 函数，要么抛给（thrown in）同步 loader 。"),(0,t.kt)("p",null,"loader 会返回一个或者两个值。第一个值的类型是 JavaScript 代码的字符串或者 buffer。第二个可选值是 SourceMap，它是个 JavaScript 对象。"),(0,t.kt)("h2",null,(0,t.kt)("span",{id:"complex-usage",parentName:"h2"}),"复杂用法",(0,t.kt)("a",{href:"#complex-usage","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"当链式调用多个 loader 的时候，请记住它们是反方向执行的。取决于数组写法格式，从右向左或者从下向上执行。"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"最后的 loader 最早调用，将会传入原始资源（raw resource）内容。"),(0,t.kt)("li",{parentName:"ul"},"第一个 loader 最后调用，期望值是传出 JavaScript 和 source map（可选）。"),(0,t.kt)("li",{parentName:"ul"},"中间的 loader 执行时，会传入前一个 loader 的结果。")),(0,t.kt)("p",null,"在下例中，",(0,t.kt)("inlineCode",{parentName:"p"},"foo-loader")," 被传入原始资源，",(0,t.kt)("inlineCode",{parentName:"p"},"bar-loader")," 将接收 ",(0,t.kt)("inlineCode",{parentName:"p"},"foo-loader")," 的产出，返回最终转化后的模块和一个 source map（可选）"),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"webpack.config.js")),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-js",parentName:"pre"},"module",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"exports ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,t.kt)("span",{className:"token comment",parentName:"code"},"//..."),"\n  module",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    rules",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"["),"\n      ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n        test",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token regex",parentName:"code"},"/\\.js/"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n        use",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"["),(0,t.kt)("span",{className:"token string",parentName:"code"},"'bar-loader'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'foo-loader'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n      ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,t.kt)("h2",null,(0,t.kt)("span",{id:"guidelines",parentName:"h2"}),"用法准则(Guidelines)",(0,t.kt)("a",{href:"#guidelines","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"编写 loader 时应该遵循以下准则。它们按重要程度排序，有些仅适用于某些场景，请阅读下面详细的章节以获得更多信息。"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"保持 ",(0,t.kt)("strong",{parentName:"li"},"简单")," 。"),(0,t.kt)("li",{parentName:"ul"},"使用 ",(0,t.kt)("strong",{parentName:"li"},"链式")," 传递。"),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"模块化")," 的输出。"),(0,t.kt)("li",{parentName:"ul"},"确保 ",(0,t.kt)("strong",{parentName:"li"},"无状态")," 。"),(0,t.kt)("li",{parentName:"ul"},"使用 ",(0,t.kt)("strong",{parentName:"li"},"loader utilities")," 。"),(0,t.kt)("li",{parentName:"ul"},"记录 ",(0,t.kt)("strong",{parentName:"li"},"loader 的依赖")," 。"),(0,t.kt)("li",{parentName:"ul"},"解析 ",(0,t.kt)("strong",{parentName:"li"},"模块依赖关系")," 。"),(0,t.kt)("li",{parentName:"ul"},"提取 ",(0,t.kt)("strong",{parentName:"li"},"通用代码")," 。"),(0,t.kt)("li",{parentName:"ul"},"避免 ",(0,t.kt)("strong",{parentName:"li"},"绝对路径")," 。"),(0,t.kt)("li",{parentName:"ul"},"使用 ",(0,t.kt)("strong",{parentName:"li"},"peer dependencies"),"。")),(0,t.kt)("h3",null,(0,t.kt)("span",{id:"simple",parentName:"h3"}),"简单(simple)",(0,t.kt)("a",{href:"#simple","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"loaders 应该只做单一任务。这不仅使每个 loader 易维护，也可以在更多场景链式调用。"),(0,t.kt)("h3",null,(0,t.kt)("span",{id:"chaining",parentName:"h3"}),"链式(chaining)",(0,t.kt)("a",{href:"#chaining","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"利用 loader 可以链式调用的优势。写五个简单的 loader 实现五项任务，而不是一个 loader 实现五项任务。功能隔离不仅使 loader 更简单，可能还可以将它们用于你原先没有想到的功能。"),(0,t.kt)("p",null,"以通过 loader 选项或者查询参数得到的数据渲染模板为例。可以把源代码编译为模板，执行并输出包含 HTML 代码的字符串写到一个 loader 中。但是根据用法准则，已经存在这样一个 ",(0,t.kt)("inlineCode",{parentName:"p"},"apply-loader"),"，可以将它和其他开源 loader 串联在一起调用。"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("inlineCode",{parentName:"li"},"pug-loader"),": 导出一个函数，把模板转换为模块。"),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("inlineCode",{parentName:"li"},"apply-loader"),": 根据 loader 选项执行函数，返回原生 HTML。"),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("inlineCode",{parentName:"li"},"html-loader"),": 接收 HTML，输出一个合法的 JS 模块。")),(0,t.kt)("aside",{className:"tip"},(0,t.kt)("h6",{className:"tip__prefix",parentName:"aside"},"提示"),(0,t.kt)("p",{parentName:"aside"},"loader 可以被链式调用意味着不一定要输出 JavaScript。只要下一个 loader 可以处理这个输出，这个 loader 就可以返回任意类型的模块。")),(0,t.kt)("h3",null,(0,t.kt)("span",{id:"modular",parentName:"h3"}),"模块化(modular)",(0,t.kt)("a",{href:"#modular","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"保证输出模块化。loader 生成的模块与普通模块遵循相同的设计原则。"),(0,t.kt)("h3",null,(0,t.kt)("span",{id:"stateless",parentName:"h3"}),"无状态(stateless)",(0,t.kt)("a",{href:"#stateless","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"确保 loader 在不同模块转换之间不保存状态。每次运行都应该独立于其他编译模块以及相同模块之前的编译结果。"),(0,t.kt)("h3",null,(0,t.kt)("span",{id:"loader-utilities",parentName:"h3"}),"loader 工具库(Loader Utilities)",(0,t.kt)("a",{href:"#loader-utilities","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"充分利用 ",(0,t.kt)("a",{href:"https://github.com/webpack/loader-utils",parentName:"p"},(0,t.kt)("inlineCode",{parentName:"a"},"loader-utils"))," 包。它提供了许多有用的工具，但最常用的一种工具是获取传递给 loader 的选项。",(0,t.kt)("a",{href:"https://github.com/webpack-contrib/schema-utils",parentName:"p"},(0,t.kt)("inlineCode",{parentName:"a"},"schema-utils"))," 包配合 ",(0,t.kt)("inlineCode",{parentName:"p"},"loader-utils"),"，用于保证 loader 选项，进行与 JSON Schema 结构一致的校验。这里有一个简单使用两者的例子："),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"loader.js")),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-js",parentName:"pre"},(0,t.kt)("span",{className:"token keyword",parentName:"code"},"import")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{")," urlToRequest ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"from")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'loader-utils'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"import")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{")," validate ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"from")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'schema-utils'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"const")," schema ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  type",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'object'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  properties",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    test",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n      type",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'string'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"export")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"default")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token parameter",parentName:"code"},"source"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"const")," options ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"getOptions"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n  ",(0,t.kt)("span",{className:"token function",parentName:"code"},"validate"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"schema",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," options",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    name",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'Example Loader'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    baseDataPath",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'options'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  \n  console",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"log"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token string",parentName:"code"},"'The request path'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"urlToRequest"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"resourcePath",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n  ",(0,t.kt)("span",{className:"token comment",parentName:"code"},"// 对资源应用一些转换……"),"\n\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"return")," ",(0,t.kt)("span",{className:"token template-string",parentName:"code"},(0,t.kt)("span",{className:"token template-punctuation string",parentName:"span"},"`"),(0,t.kt)("span",{className:"token string",parentName:"span"},"export default "),(0,t.kt)("span",{className:"token interpolation",parentName:"span"},(0,t.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"${"),(0,t.kt)("span",{className:"token constant",parentName:"span"},"JSON"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"."),(0,t.kt)("span",{className:"token function",parentName:"span"},"stringify"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"("),"source",(0,t.kt)("span",{className:"token punctuation",parentName:"span"},")"),(0,t.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"}")),(0,t.kt)("span",{className:"token template-punctuation string",parentName:"span"},"`")),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"))),(0,t.kt)("h3",null,(0,t.kt)("span",{id:"loader-dependencies",parentName:"h3"}),"loader 依赖(loader dependencies)",(0,t.kt)("a",{href:"#loader-dependencies","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"如果一个 loader 使用外部资源（例如，从文件系统读取），",(0,t.kt)("strong",{parentName:"p"},"必须"),"声明它。这些信息用于使缓存 loaders 无效，以及在观察模式(watch mode)下重编译。下面是一个简单示例，说明如何使用 ",(0,t.kt)("inlineCode",{parentName:"p"},"addDependency")," 方法实现上述声明："),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"loader.js")),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-js",parentName:"pre"},(0,t.kt)("span",{className:"token keyword",parentName:"code"},"import")," path ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"from")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'path'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"export")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"default")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token parameter",parentName:"code"},"source"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"var")," callback ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"async"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"var")," headerPath ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," path",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"resolve"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token string",parentName:"code"},"'header.js'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"addDependency"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"headerPath",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n  fs",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"readFile"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"headerPath",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'utf-8'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token parameter",parentName:"code"},"err",(0,t.kt)("span",{className:"token punctuation",parentName:"span"},",")," header"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"if")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"err",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"return")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"callback"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"err",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n    ",(0,t.kt)("span",{className:"token function",parentName:"code"},"callback"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token keyword",parentName:"code"},"null"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," header ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"+")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'\\n'")," ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"+")," source",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"))),(0,t.kt)("h3",null,(0,t.kt)("span",{id:"module-dependencies",parentName:"h3"}),"模块依赖(module dependencies)",(0,t.kt)("a",{href:"#module-dependencies","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"根据模块类型，可能会有不同的模式指定依赖关系。例如在 CSS 中，使用 ",(0,t.kt)("inlineCode",{parentName:"p"},"@import")," 和 ",(0,t.kt)("inlineCode",{parentName:"p"},"url(...)")," 语句来声明依赖。这些依赖关系应该由模块系统解析。"),(0,t.kt)("p",null,"可以通过以下两种方式中的一种来实现："),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"通过把它们转化成 ",(0,t.kt)("inlineCode",{parentName:"li"},"require")," 语句。"),(0,t.kt)("li",{parentName:"ul"},"使用 ",(0,t.kt)("inlineCode",{parentName:"li"},"this.resolve")," 函数解析路径。")),(0,t.kt)("p",null,(0,t.kt)("inlineCode",{parentName:"p"},"css-loader")," 是第一种方式的一个例子。它将 ",(0,t.kt)("inlineCode",{parentName:"p"},"@import")," 语句替换为 ",(0,t.kt)("inlineCode",{parentName:"p"},"require")," 其他样式文件，将 ",(0,t.kt)("inlineCode",{parentName:"p"},"url(...)")," 替换为 ",(0,t.kt)("inlineCode",{parentName:"p"},"require")," 引用文件，从而实现将依赖关系转化为 ",(0,t.kt)("inlineCode",{parentName:"p"},"require")," 声明。"),(0,t.kt)("p",null,"对于 ",(0,t.kt)("inlineCode",{parentName:"p"},"less-loader"),"，无法将每个 ",(0,t.kt)("inlineCode",{parentName:"p"},"@import")," 转化为 ",(0,t.kt)("inlineCode",{parentName:"p"},"require"),"，因为所有 ",(0,t.kt)("inlineCode",{parentName:"p"},".less")," 的文件中的变量和混合跟踪必须一次编译。因此，",(0,t.kt)("inlineCode",{parentName:"p"},"less-loader")," 将 ",(0,t.kt)("inlineCode",{parentName:"p"},"less")," 编译器进行了扩展，自定义路径解析逻辑。然后，利用第二种方式，通过 webpack 的 ",(0,t.kt)("inlineCode",{parentName:"p"},"this.resolve")," 解析依赖。"),(0,t.kt)("aside",{className:"tip"},(0,t.kt)("h6",{className:"tip__prefix",parentName:"aside"},"提示"),(0,t.kt)("p",{parentName:"aside"},"如果语言只支持相对 url（例如 ",(0,t.kt)("inlineCode",{parentName:"p"},"url(file)")," 总是指向 ",(0,t.kt)("inlineCode",{parentName:"p"},"./file"),"），通过使用 ",(0,t.kt)("inlineCode",{parentName:"p"},"~")," 来指定已安装模块（例如，引用 ",(0,t.kt)("inlineCode",{parentName:"p"},"node_modules")," 中的那些模块）。所以对于 ",(0,t.kt)("inlineCode",{parentName:"p"},"url"),"，相当于 ",(0,t.kt)("inlineCode",{parentName:"p"},"url('~some-library/image.jpg')"),"。")),(0,t.kt)("h3",null,(0,t.kt)("span",{id:"common-code",parentName:"h3"}),"通用代码(common code)",(0,t.kt)("a",{href:"#common-code","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"避免在 loader 处理的每个模块中生成通用代码。相反，你应该在 loader 中创建一个运行时文件，并生成 ",(0,t.kt)("inlineCode",{parentName:"p"},"require")," 语句以引用该共享模块："),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"src/loader-runtime.js")),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-js",parentName:"pre"},(0,t.kt)("span",{className:"token keyword",parentName:"code"},"const")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{")," someOtherModule ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}")," ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"require"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token string",parentName:"code"},"'./some-other-module'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\nmodule",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function-variable function",parentName:"code"},"exports")," ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"runtime"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token parameter",parentName:"code"},"params"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"const")," x ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," params",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"y ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"*")," ",(0,t.kt)("span",{className:"token number",parentName:"code"},"2"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"return")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"someOtherModule"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"params",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," x",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"src/loader.js")),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-js",parentName:"pre"},(0,t.kt)("span",{className:"token keyword",parentName:"code"},"import")," runtime ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"from")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'./loader-runtime.js'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"export")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"default")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"loader"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token parameter",parentName:"code"},"source"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,t.kt)("span",{className:"token comment",parentName:"code"},"// 自定义的 loader 逻辑"),"\n\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"return")," ",(0,t.kt)("span",{className:"token template-string",parentName:"code"},(0,t.kt)("span",{className:"token template-punctuation string",parentName:"span"},"`"),(0,t.kt)("span",{className:"token interpolation",parentName:"span"},(0,t.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"${"),(0,t.kt)("span",{className:"token function",parentName:"span"},"runtime"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"("),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"{"),"\n    source",(0,t.kt)("span",{className:"token punctuation",parentName:"span"},","),"\n    y",(0,t.kt)("span",{className:"token operator",parentName:"span"},":")," Math",(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"."),(0,t.kt)("span",{className:"token function",parentName:"span"},"random"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"("),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},","),"\n  ",(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},")"),(0,t.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"}")),(0,t.kt)("span",{className:"token template-punctuation string",parentName:"span"},"`")),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"))),(0,t.kt)("h3",null,(0,t.kt)("span",{id:"absolute-paths",parentName:"h3"}),"绝对路径(absolute paths)",(0,t.kt)("a",{href:"#absolute-paths","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"不要在模块代码中插入绝对路径，因为当项目根路径变化时，文件绝对路径也会变化。",(0,t.kt)("inlineCode",{parentName:"p"},"loader-utils")," 中的 ",(0,t.kt)("a",{href:"https://github.com/webpack/loader-utils#stringifyrequest",parentName:"p"},(0,t.kt)("inlineCode",{parentName:"a"},"stringifyRequest"))," 方法，可以将绝对路径转化为相对路径。"),(0,t.kt)("h3",null,(0,t.kt)("span",{id:"peer-dependencies",parentName:"h3"}),"同等依赖(peer dependencies)",(0,t.kt)("a",{href:"#peer-dependencies","aria-hidden":"true",tabIndex:"-1",parentName:"h3"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"如果你的 loader 简单包裹另外一个包，你应该把这个包作为一个 ",(0,t.kt)("inlineCode",{parentName:"p"},"peerDependency")," 引入。这种方式允许应用程序开发者在必要情况下，在 ",(0,t.kt)("inlineCode",{parentName:"p"},"package.json")," 中指定所需的确定版本。"),(0,t.kt)("p",null,"例如，",(0,t.kt)("inlineCode",{parentName:"p"},"sass-loader")," ",(0,t.kt)("a",{href:"https://github.com/webpack-contrib/sass-loader/blob/master/package.json",parentName:"p"},"指定 ",(0,t.kt)("inlineCode",{parentName:"a"},"node-sass"))," 作为同等依赖，引用如下："),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-json",parentName:"pre"},(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,t.kt)("span",{className:"token property",parentName:"code"},'"peerDependencies"'),(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    ",(0,t.kt)("span",{className:"token property",parentName:"code"},'"node-sass"'),(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},'"^4.0.0"'),"\n  ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"))),(0,t.kt)("h2",null,(0,t.kt)("span",{id:"testing",parentName:"h2"}),"测试",(0,t.kt)("a",{href:"#testing","aria-hidden":"true",tabIndex:"-1",parentName:"h2"},(0,t.kt)("span",{className:"header-link",parentName:"a"}))),(0,t.kt)("p",null,"当你遵循上面的用法准则编写了一个 loader，并且可以在本地运行。下一步该做什么呢？让我们用一个简单的单元测试，来保证 loader 能够按照我们预期的方式正确运行。我们将使用 ",(0,t.kt)("a",{href:"https://jestjs.io/",parentName:"p"},"Jest")," 框架。然后还需要安装 ",(0,t.kt)("inlineCode",{parentName:"p"},"babel-jest")," 和允许我们使用 ",(0,t.kt)("inlineCode",{parentName:"p"},"import")," / ",(0,t.kt)("inlineCode",{parentName:"p"},"export")," 和 ",(0,t.kt)("inlineCode",{parentName:"p"},"async")," / ",(0,t.kt)("inlineCode",{parentName:"p"},"await")," 的一些预设环境(presets)。让我们开始安装，并且将这些依赖保存为 ",(0,t.kt)("inlineCode",{parentName:"p"},"devDependencies"),"："),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-bash",parentName:"pre"},(0,t.kt)("span",{className:"token function",parentName:"code"},"npm")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"install")," --save-dev jest babel-jest @babel/core @babel/preset-env")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"babel.config.js")),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-js",parentName:"pre"},"module",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"exports ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  presets",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"["),"\n    ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"["),"\n      ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'@babel/preset-env'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n      ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n        targets",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n          node",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'current'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n        ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n      ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,t.kt)("p",null,"我们的 loader 将会处理 ",(0,t.kt)("inlineCode",{parentName:"p"},".txt")," 文件，并且将任何实例中的 ",(0,t.kt)("inlineCode",{parentName:"p"},"[name]")," 直接替换为 loader 选项中设置的 ",(0,t.kt)("inlineCode",{parentName:"p"},"name"),"。然后返回包含默认导出文本的 JavaScript 模块："),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"src/loader.js")),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-js",parentName:"pre"},(0,t.kt)("span",{className:"token keyword",parentName:"code"},"export")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"default")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"function")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"loader"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token parameter",parentName:"code"},"source"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"const")," options ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"this"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"getOptions"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n  source ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," source",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"replace"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token regex",parentName:"code"},"/\\[name\\]/g"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," options",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"name",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"return")," ",(0,t.kt)("span",{className:"token template-string",parentName:"code"},(0,t.kt)("span",{className:"token template-punctuation string",parentName:"span"},"`"),(0,t.kt)("span",{className:"token string",parentName:"span"},"export default "),(0,t.kt)("span",{className:"token interpolation",parentName:"span"},(0,t.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"${"),(0,t.kt)("span",{className:"token constant",parentName:"span"},"JSON"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"."),(0,t.kt)("span",{className:"token function",parentName:"span"},"stringify"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"("),"source",(0,t.kt)("span",{className:"token punctuation",parentName:"span"},")"),(0,t.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"}")),(0,t.kt)("span",{className:"token template-punctuation string",parentName:"span"},"`")),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"))),(0,t.kt)("p",null,"我们将会使用这个 loader 处理以下文件："),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"test/example.txt")),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-bash",parentName:"pre"},"Hey ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"["),"name",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,t.kt)("span",{className:"token operator",parentName:"code"},"!"))),(0,t.kt)("p",null,"请注意留心接下来的步骤，我们将会使用 ",(0,t.kt)("a",{href:"/api/node",parentName:"p"},"Node.js API")," 和 ",(0,t.kt)("a",{href:"https://github.com/streamich/memfs",parentName:"p"},(0,t.kt)("inlineCode",{parentName:"a"},"memfs"))," 去执行 webpack。这让我们避免向磁盘产生 ",(0,t.kt)("inlineCode",{parentName:"p"},"输出文件"),"，并允许我们访问获取转换模块的统计数据 ",(0,t.kt)("inlineCode",{parentName:"p"},"stats"),"："),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-bash",parentName:"pre"},(0,t.kt)("span",{className:"token function",parentName:"code"},"npm")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"install")," --save-dev webpack memfs")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"test/compiler.js")),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-js",parentName:"pre"},(0,t.kt)("span",{className:"token keyword",parentName:"code"},"import")," path ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"from")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'path'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"import")," webpack ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"from")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'webpack'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"import")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{")," createFsFromVolume",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," Volume ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"from")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'memfs'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"export")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"default")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token parameter",parentName:"code"},"fixture",(0,t.kt)("span",{className:"token punctuation",parentName:"span"},",")," options ",(0,t.kt)("span",{className:"token operator",parentName:"span"},"=")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"{"),(0,t.kt)("span",{className:"token punctuation",parentName:"span"},"}")),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=>")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"const")," compiler ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"webpack"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    context",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," __dirname",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    entry",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token template-string",parentName:"code"},(0,t.kt)("span",{className:"token template-punctuation string",parentName:"span"},"`"),(0,t.kt)("span",{className:"token string",parentName:"span"},"./"),(0,t.kt)("span",{className:"token interpolation",parentName:"span"},(0,t.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"${"),"fixture",(0,t.kt)("span",{className:"token interpolation-punctuation punctuation",parentName:"span"},"}")),(0,t.kt)("span",{className:"token template-punctuation string",parentName:"span"},"`")),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    output",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n      path",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," path",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"resolve"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"__dirname",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n      filename",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'bundle.js'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    module",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n      rules",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"["),"\n        ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n          test",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token regex",parentName:"code"},"/\\.txt$/"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n          use",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n            loader",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," path",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"resolve"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"__dirname",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'../src/loader.js'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n            options",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n          ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n        ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n      ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n    ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n  compiler",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"outputFileSystem ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"createFsFromVolume"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token keyword",parentName:"code"},"new")," ",(0,t.kt)("span",{className:"token class-name",parentName:"code"},"Volume"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  compiler",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"outputFileSystem",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"join ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," path",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"join"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"bind"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"path",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"return")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"new")," ",(0,t.kt)("span",{className:"token class-name",parentName:"code"},"Promise"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token parameter",parentName:"code"},"resolve",(0,t.kt)("span",{className:"token punctuation",parentName:"span"},",")," reject"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=>")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    compiler",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"run"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token parameter",parentName:"code"},"err",(0,t.kt)("span",{className:"token punctuation",parentName:"span"},",")," stats"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=>")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n      ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"if")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"err",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"reject"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"err",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n      ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"if")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"stats",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"hasErrors"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"reject"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"stats",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"toJson"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"errors",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n      ",(0,t.kt)("span",{className:"token function",parentName:"code"},"resolve"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"stats",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n    ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,t.kt)("aside",{className:"tip"},(0,t.kt)("h6",{className:"tip__prefix",parentName:"aside"},"提示"),(0,t.kt)("p",{parentName:"aside"},"这种情况下，我们可以内联 webpack 配置，也可以把配置作为参数传给导出的函数。这允许我们使用相同的编译模块测试多个设置。")),(0,t.kt)("p",null,"最后，我们来编写测试，并且添加 npm script 运行它："),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"test/loader.test.js")),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-js",parentName:"pre"},(0,t.kt)("span",{className:"token comment",parentName:"code"},"/**\n * @jest-environment node\n */"),"\n",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"import")," compiler ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"from")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'./compiler.js'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n",(0,t.kt)("span",{className:"token function",parentName:"code"},"test"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token string",parentName:"code"},"'Inserts name and outputs JavaScript'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"async")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")")," ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=>")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"const")," stats ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"await")," ",(0,t.kt)("span",{className:"token function",parentName:"code"},"compiler"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token string",parentName:"code"},"'example.txt'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},",")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{")," name",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},"'Alice'")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n  ",(0,t.kt)("span",{className:"token keyword",parentName:"code"},"const")," output ",(0,t.kt)("span",{className:"token operator",parentName:"code"},"=")," stats",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"toJson"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{")," source",(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token boolean",parentName:"code"},"true")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"modules",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"["),(0,t.kt)("span",{className:"token number",parentName:"code"},"0"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"]"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),"source",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n\n  ",(0,t.kt)("span",{className:"token function",parentName:"code"},"expect"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"output",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"."),(0,t.kt)("span",{className:"token function",parentName:"code"},"toBe"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),(0,t.kt)("span",{className:"token string",parentName:"code"},"'export default \"Hey Alice!\\\\n\"'"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},";"))),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"package.json")),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-json",parentName:"pre"},(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n  ",(0,t.kt)("span",{className:"token property",parentName:"code"},'"scripts"'),(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    ",(0,t.kt)("span",{className:"token property",parentName:"code"},'"test"'),(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},'"jest"'),"\n  ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),(0,t.kt)("span",{className:"token punctuation",parentName:"code"},","),"\n  ",(0,t.kt)("span",{className:"token property",parentName:"code"},'"jest"'),(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"{"),"\n    ",(0,t.kt)("span",{className:"token property",parentName:"code"},'"testEnvironment"'),(0,t.kt)("span",{className:"token operator",parentName:"code"},":")," ",(0,t.kt)("span",{className:"token string",parentName:"code"},'"node"'),"\n  ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"),"\n",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"}"))),(0,t.kt)("p",null,"准备就绪后，我们可以运行它，然后看新的 loader 是否能通过测试："),(0,t.kt)("pre",null,(0,t.kt)("code",{className:"hljs language-bash",parentName:"pre"}," PASS  test/loader.test.js\n  ✓ Inserts name and outputs JavaScript ",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},"("),"229ms",(0,t.kt)("span",{className:"token punctuation",parentName:"code"},")"),"\n\nTest Suites: ",(0,t.kt)("span",{className:"token number",parentName:"code"},"1")," passed, ",(0,t.kt)("span",{className:"token number",parentName:"code"},"1")," total\nTests:       ",(0,t.kt)("span",{className:"token number",parentName:"code"},"1")," passed, ",(0,t.kt)("span",{className:"token number",parentName:"code"},"1")," total\nSnapshots:   ",(0,t.kt)("span",{className:"token number",parentName:"code"},"0")," total\nTime:        ",(0,t.kt)("span",{className:"token number",parentName:"code"},"1"),".853s, estimated 2s\nRan all ",(0,t.kt)("span",{className:"token builtin class-name",parentName:"code"},"test")," suites.")),(0,t.kt)("p",null,"一切正常！现在，你应该准备开始开发、测试、部署你的 loaders 了。我们希望你可以在社区分享你的 loader！"))}p.isMDXComponent=!0,e.default=p}}]);