<!DOCTYPE html><html lang="zh-cmn-Hans"><head><title data-rh="true">自定义插件 | webpack 中文文档</title><meta data-rh="true" charset="utf-8"/><meta data-rh="true" name="theme-color" content="#2B3A42"/><meta data-rh="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-rh="true" name="description" content="webpack 是一个模块打包器。它的主要目标是将 JavaScript 文件打包在一起，打包后的文件用于在浏览器中使用，但它也能够胜任转换、打包或包裹任何资源。"/><meta data-rh="true" property="og:site_name" content="webpack"/><meta data-rh="true" property="og:type" content="website"/><meta data-rh="true" property="og:title" content="自定义插件 | webpack 中文文档"/><meta data-rh="true" property="og:description" name="description" content="webpack 是一个模块打包器。它的主要目标是将 JavaScript 文件打包在一起，打包后的文件用于在浏览器中使用，但它也能够胜任转换、打包或包裹任何资源。"/><meta data-rh="true" property="og:image" content="https://webpack.js.org/icon-pwa-512x512.d3dae4189855b3a72ff9.png"/><meta data-rh="true" property="twitter:card" content="summary"/><meta data-rh="true" property="twitter:site" content="@webpack"/><meta data-rh="true" property="twitter:creator" content="@webpack"/><meta data-rh="true" property="twitter:domain" content="https://webpack.js.org/"/><meta data-rh="true" name="keywords" content="webpack5, webpack, webpack 中文文档, webpack 官方中文, webpack 5 官方中文, 印记中文, docschina, docschina.org, webpack.docschina.org, doc.react-china.org, nodejs.cn, vue.docschina.org, babel.docschina.org, parceljs.docschina.org, rollup.docschina.org, koajs.docschina.org"/><meta data-rh="true" name="mobile-web-app-capable" content="yes"/><meta data-rh="true" name="apple-mobile-web-app-capable" content="yes"/><meta data-rh="true" name="apple-mobile-web-app-status-bar-style" content="black"/><meta data-rh="true" name="apple-mobile-web-app-title" content="webpack"/><meta data-rh="true" name="msapplication-TileImage" content="/icon_150x150.png"/><meta data-rh="true" name="msapplication-TileColor" content="#465e69"/><link data-rh="true" rel="icon" type="image/x-icon" href="/favicon.f326220248556af65f41.ico"/><link data-rh="true" rel="manifest" href="/manifest.json"/><link data-rh="true" rel="canonical" href="https://webpack.docschina.org/contribute/writing-a-plugin/"/><link data-rh="true" rel="icon" sizes="192x192" href="/icon_192x192.png"/><link data-rh="true" rel="icon" sizes="512x512" href="/icon_512x512.png"/><link data-rh="true" rel="apple-touch-icon" href="/icon_180x180.png"/><link data-rh="true" rel="mask-icon" href="/logo-on-white-bg.47eff95f9c01c5972f6f.svg" color="#465e69"/><link rel="stylesheet" href=/index.c114afea0778b47a418a.css /><link rel="stylesheet" href=/9517.acfe42251eae743e4e22.css /></head><body><div id="root"><div class="site"><div class="site__header"><header class="bg-blue-800 dark:bg-gray-900"><div class="flex items-center py-10 px-[16px] justify-between md:px-[24px] md:max-w-[1024px] md:mx-auto md:justify-start"><button class="bg-transparent border-none md:hidden"><svg viewBox="-62 138 25 25" width="20" height="20" class="fill-current text-white"><path fill="currentColor" d="M-60.2 140.2h20.9c1 0 1.8.8 1.8 1.8s-.8 1.8-1.8 1.8h-20.9c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8M-60.2 148.7h20.9c1 0 1.8.8 1.8 1.8s-.8 1.8-1.8 1.8h-20.9c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8M-60.2 157.2h20.9c1 0 1.8.8 1.8 1.8s-.8 1.8-1.8 1.8h-20.9c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8"></path></svg></button><a class="md:mr-auto" href="/"><img class="logo" src="/site-logo.1fcab817090e78435061.svg" alt="webpack logo" width="122" height="35"/></a><nav class="hidden md:inline-grid md:grid-flow-col md:gap-x-[18px]"><a class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200" href="/concepts/">中文文档</a><a aria-current="page" class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200 !text-blue-200" href="/contribute/">参与贡献</a><a class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200" href="/blog/">博客</a><a href="https://docschina.org" target="_blank" rel="noopener noreferrer" class="text-gray-100 dark:text-gray-100 text-sm font-light uppercase hover:text-blue-200">印记中文</a><a href="https://github.com/webpack/webpack" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-100 dark:text-gray-200 hover:text-blue-200" title="webpack on GitHub"><svg viewBox="0 0 24 24" aria-hidden="true" fill="currentColor" width="16"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 6.8 9.5c.5 0 .7-.2.7-.5v-1.7C6.7 20 6.1 18 6.1 18c-.4-1.2-1-1.5-1-1.5-1-.6 0-.6 0-.6 1 0 1.5 1 1.5 1 .9 1.6 2.4 1.1 3 .9 0-.7.3-1.1.6-1.4-2.2-.2-4.6-1-4.6-4.9 0-1.1.4-2 1-2.7 0-.3-.4-1.3.2-2.7 0 0 .8-.2 2.7 1a9.4 9.4 0 0 1 5 0c2-1.2 2.8-1 2.8-1 .5 1.4.1 2.4 0 2.7.7.7 1 1.6 1 2.7 0 3.8-2.3 4.7-4.5 5 .4.2.7.8.7 1.8V21c0 .3.2.6.7.5 4-1.3 6.8-5 6.8-9.5A10 10 0 0 0 12 2"></path></svg></a><a href="https://twitter.com/webpack" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-100 dark:text-gray-200 hover:text-blue-200" title="webpack on Twitter"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" aria-hidden="true" fill="currentColor" width="16"><path d="M28 6.937c-.957.425-1.985.711-3.064.84a5.343 5.343 0 0 0 2.345-2.951 10.696 10.696 0 0 1-3.388 1.295 5.334 5.334 0 0 0-9.089 4.864A15.143 15.143 0 0 1 3.809 5.411a5.321 5.321 0 0 0-.721 2.683 5.33 5.33 0 0 0 2.372 4.439 5.323 5.323 0 0 1-2.416-.667v.067a5.335 5.335 0 0 0 4.279 5.23 5.336 5.336 0 0 1-2.409.092 5.34 5.34 0 0 0 4.983 3.705 10.699 10.699 0 0 1-6.625 2.284c-.43 0-.855-.025-1.273-.075a15.102 15.102 0 0 0 8.177 2.396c9.812 0 15.176-8.128 15.176-15.177 0-.231-.005-.461-.015-.69A10.855 10.855 0 0 0 28 6.937z"></path></svg></a><a href="https://stackoverflow.com/questions/tagged/webpack" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-100 dark:text-gray-200 hover:text-blue-200" title="webpack on StackOverflow"><svg viewBox="0 0 24 24" aria-hidden="true" fill="currentColor" width="16"><path d="M17.4 20.2v-5.4h1.8V22H3v-7.2h1.8v5.4zM6.8 14.3l.3-1.7 8.8 1.8-.3 1.8zm1.1-4.2.8-1.6 8.1 3.8-.7 1.6zm2.3-4 1.1-1.4 7 5.8-1.2 1.4L10 6m4.7-4L20 9l-1.4 1-5.4-7 1.4-1m-8 16.5v-1.8h9v1.8z"></path></svg></a><nav class="dropdown "><button aria-haspopup="true" aria-expanded="false" aria-label="Select language"><svg viewBox="0 0 610 560" xmlns="http://www.w3.org/2000/svg" class="dropdown__language text-gray-100 hover:text-blue-200 transition-colors duration-200"><path d="m304.8 99.2-162.5-57.3v353.6l162.5-52.6z"></path><path d="m300.9 99 168.7-57.3v353.6l-168.7-52.5zm-200.7 358.4 200.7-66.9v-291.5l-200.7 66.9z" fill="currentColor"></path><path d="m392.4 461.8 28.4 46.8 15-43.5zm-223.9-262.3c-1.1-1 1.4 8.6 4.8 12 6.1 6.1 10.8 6.9 13.3 7 5.6.2 12.5-1.4 16.5-3.1s10.9-5.2 13.5-10.4c.6-1.1 2.1-3 1.1-7.5-.7-3.5-3-4.8-5.7-4.6s-11 2.4-15 3.6-12.2 3.7-15.8 4.5-11.5-.3-12.7-1.5zm101.2 114.8c-1.6-.6-34.3-14.1-38.9-16.4a368 368 0 0 0 -17.5-7.5c12.3-19 20.1-33.4 21.2-35.6 1.9-4 15-29.5 15.3-31.1s.7-7.5.4-8.9-5.1 1.3-11.6 3.5-18.9 10.2-23.7 11.2-20.1 6.8-28 9.4c-7.8 2.6-22.7 7.1-28.8 8.8-6.1 1.6-11.4 1.8-14.9 2.8 0 0 .5 4.8 1.4 6.2s4.1 5 7.9 5.9c3.8 1 10 .6 12.8-.1s7.7-3.1 8.4-4.1c.7-1.1-.3-4.3.8-5.3s16.1-4.5 21.7-6.2 27.2-9.2 30.1-8.8a916 916 0 0 1 -23.9 47.7 821 821 0 0 1 -45 63.3c-5.3 6-18 21.5-22.4 25 1.1.3 9-.4 10.4-1.3 8.9-5.5 23.8-24.1 28.6-29.7a489.1 489.1 0 0 0 36.7-49.4c1.9.8 17.6 13.6 21.7 16.4a293 293 0 0 0 23.7 13.3c3.5 1.5 16.9 7.7 17.5 5.6.7-1.8-2.3-14.1-3.9-14.7z"></path><path clip-rule="evenodd" d="m194.1 484.7a204.9 204.9 0 0 0 30.7 14.5 233.6 233.6 0 0 0 46.4 12c.5 0 16 1.9 19.2 1.9h15.7c6.1-.5 11.8-.9 17.9-1.7 4.9-.7 10.3-1.6 15.5-2.8 3.8-.9 7.8-1.7 11.7-3 3.7-1 7.8-2.4 11.8-3.8l8.2-3.1c2.3-1 5.1-2.3 7.7-3.3a243 243 0 0 0 19.2-10c2.3-1.2 7.5-5.2 10.3-5.2 3.1 0 5.2 2.8 5.2 5.2 0 5.1-6.8 6.6-9.9 8.9-3.3 2.3-7.3 4-10.8 5.9-7 3.7-14.1 6.8-20.9 9.4a251 251 0 0 1 -27.3 8.5c-3.3.7-6.6 1.6-9.9 2.1-1.7.3-19.9 3.1-24.9 3.1h-23a293.9 293.9 0 0 1 -35.1-5.2 196 196 0 0 1 -33.1-10.3c-12-4.5-24.6-10.5-36.4-18.3-2.1-1.4-2.3-2.8-2.3-4.4a5 5 0 0 1 5.1-5.1c2.4.1 8 4.2 9 4.7zm101.4-98.1-189.9 63.2v-280.1l189.9-63.2zm10.6-288.3v292.7a6 6 0 0 1 -1.2 2.6c-.3.5-1 1.2-1.6 1.4a14621 14621 0 0 1 -203.1 67.6c-2.1 0-4-1.4-5.1-3.7 0-.2-.2-.3-.2-.7v-292.8c.3-.9.5-2.1 1.2-2.8 1.4-1.9 3.8-2.3 5.4-2.8 3-1 196.1-65.8 198.9-65.8 1.9 0 5.7 1.2 5.7 4.3z" fill-rule="evenodd"></path><path clip-rule="evenodd" d="m464.3 388-158-49.1v-236l158-53.7zm10.6-345.8v352.4c-.2 4-3 5.7-5.6 5.7-2.3 0-18.6-5.6-21.4-6.4l-65.8-20.4-14.6-4.7-12.9-4c-18.6-5.7-37.6-11.5-56.3-17.8-.7-.2-2.4-2.6-2.4-3.1v-246.1c.3-.9.7-1.9 1.6-2.6 1.4-1.6 61.1-21.4 84.7-29.3 6.3-2.3 84.8-29.3 87.3-29.3 3 .1 5.4 2.3 5.4 5.6z" fill-rule="evenodd"></path><path d="m515 461.8-211.1-67.3.9-292.8 210.2 66.9z"></path><path clip-rule="evenodd" d="m408.6 232.5-20.7 50.1 38.1 11.5zm-12.4-47.2 27.2 8.2 49.5 178.6-27.9-8.5-10-36.7-57.7-17.5-12.4 29.9-27.9-8.5z" fill="currentColor" fill-rule="evenodd"></path></svg><i aria-hidden="true" class="dropdown__arrow"></i></button><div class="dropdown__list "><ul><li><a href="https://webpack.js.org/contribute/writing-a-plugin/" class="px-5 block"><span>English</span></a></li><li><a href="https://webpack.docschina.org/contribute/writing-a-plugin/" class="px-5 block"><span lang="zh">中文</span></a></li><li><a href="https://webpack.kr/contribute/writing-a-plugin/" class="px-5 block"><span lang="ko">한국어</span></a></li></ul></div></nav></nav><div class="inline-flex items-center ml-[18px]"><button aria-label="Switch to dark theme" class="bg-transparent border-none cursor-pointer text-[16px] p-0 inline-flex items-center text-gray-100 hover:text-blue-200 transition-colors duration-200" data-testid="hello-darkness"><svg width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18.1406C11.6016 18.1406 11.2782 18.464 11.2782 18.8624V21.0281C11.2782 21.4265 11.6016 21.7499 12 21.7499C12.3985 21.7499 12.7219 21.4265 12.7219 21.0281V18.8624C12.7219 18.464 12.3985 18.1406 12 18.1406V18.1406Z" fill="currentColor"></path><path d="M12 2.25006C11.6016 2.25006 11.2782 2.5735 11.2782 2.97194V5.13756C11.2782 5.536 11.6016 5.85944 12 5.85944C12.3985 5.85944 12.7219 5.536 12.7219 5.13756V2.97194C12.7219 2.5735 12.3985 2.25006 12 2.25006V2.25006Z" fill="currentColor"></path><path d="M5.85936 12C5.85936 11.6015 5.53592 11.2781 5.13749 11.2781H2.97186C2.57342 11.2781 2.24999 11.6015 2.24999 12C2.24999 12.3984 2.57342 12.7218 2.97186 12.7218H5.13749C5.53592 12.7218 5.85936 12.3984 5.85936 12V12Z" fill="currentColor"></path><path d="M21.0281 11.2781H18.8625C18.4641 11.2781 18.1406 11.6015 18.1406 12C18.1406 12.3984 18.4641 12.7218 18.8625 12.7218H21.0281C21.4266 12.7218 21.75 12.3984 21.75 12C21.75 11.6015 21.4266 11.2781 21.0281 11.2781V11.2781Z" fill="currentColor"></path><path d="M7.14841 16.1298C6.95622 16.1298 6.77341 16.2048 6.63747 16.3407L5.10466 17.8735C4.96872 18.0094 4.89372 18.1923 4.89372 18.3844C4.89372 18.5766 4.96872 18.7594 5.10466 18.8954C5.2406 19.0313 5.42341 19.1063 5.6156 19.1063C5.80779 19.1063 5.9906 19.0313 6.12654 18.8954L7.65935 17.3626C7.9406 17.0813 7.9406 16.6219 7.65935 16.3407C7.52341 16.2048 7.3406 16.1298 7.14841 16.1298V16.1298Z" fill="currentColor"></path><path d="M16.8516 7.87036C17.0437 7.87036 17.2266 7.79536 17.3625 7.65942L18.8953 6.12661C19.0312 5.99067 19.1062 5.80786 19.1062 5.61567C19.1062 5.42349 19.0312 5.24067 18.8953 5.10474C18.7594 4.9688 18.5766 4.8938 18.3844 4.8938C18.1922 4.8938 18.0094 4.9688 17.8734 5.10474L16.3406 6.63755C16.2047 6.77349 16.1297 6.9563 16.1297 7.14849C16.1297 7.34067 16.2047 7.52349 16.3406 7.65942C16.4766 7.79536 16.6594 7.87036 16.8516 7.87036V7.87036Z" fill="currentColor"></path><path d="M6.12654 5.10474C5.9906 4.9688 5.80779 4.8938 5.6156 4.8938C5.42341 4.8938 5.2406 4.9688 5.10466 5.10474C4.96872 5.24067 4.89372 5.42349 4.89372 5.61567C4.89372 5.80786 4.96872 5.99067 5.10466 6.12661L6.63747 7.65942C6.77341 7.79536 6.95622 7.87036 7.14841 7.87036C7.3406 7.87036 7.52341 7.79536 7.65935 7.65942C7.79529 7.52349 7.87029 7.34067 7.87029 7.14849C7.87029 6.9563 7.79529 6.77349 7.65935 6.63755L6.12654 5.10474V5.10474Z" fill="currentColor"></path><path d="M17.3625 16.3407C17.2266 16.2048 17.0437 16.1298 16.8516 16.1298C16.6594 16.1298 16.4766 16.2048 16.3406 16.3407C16.0594 16.6219 16.0594 17.0813 16.3406 17.3626L17.8734 18.8954C18.0094 19.0313 18.1922 19.1063 18.3844 19.1063C18.5766 19.1063 18.7594 19.0313 18.8953 18.8954C19.0312 18.7594 19.1062 18.5766 19.1062 18.3844C19.1062 18.1923 19.0312 18.0094 18.8953 17.8735L17.3625 16.3407V16.3407Z" fill="currentColor"></path><path d="M12 7.5C9.52031 7.5 7.5 9.52031 7.5 12C7.5 14.4797 9.52031 16.5 12 16.5C14.4797 16.5 16.5 14.4797 16.5 12C16.5 9.52031 14.4797 7.5 12 7.5Z" fill="currentColor"></path></svg></button><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></header></div><div class="container site__content"><div class="sponsors"><a href="https://docschina.org" target="_blank" rel="noopener noreferrer" class="sponsors__content"><img class="sponsors__img__docschina" src="/docschina-logo.59f03f74b3c450856c01.png"/><div class="sponsors__content-cont">翻译/文档内容有任何问题，请联系我们</div><div class="wwads-cn wwads-horizontal wwads-sticky" data-id="306" style="max-width:350px"></div></a></div><nav class="sidebar site__sidebar"><div class="sidebar__inner"><div class="relative z-0 bg-white dark:bg-gray-100 "><select class="text-gray-600 text-14 px-5 py-5 appearance-none box-border border border-gray-200 border-solid flex-col flex w-full rounded-none bg-transparent bg-none"><option selected="" value="5">Webpack 5</option><option value="4">Webpack 4</option></select><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="absolute right-5 top-5 fill-current text-gray-300 z-[-1]" width="20" height="20"><path d="M4.5 7.5c.5-.4 1-.4 1.6 0l3.9 3.8 4-3.8c.4-.4 1-.4 1.5 0 .4.5.4 1.2 0 1.7l-4.7 4.5a1 1 0 0 1-1.6 0L4.5 9.2c-.4-.5-.4-1.2 0-1.7z"></path></svg></div><div class="sidebar-item sidebar-item--disabled`"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="sidebar-item__toggle" width="15" height="17" fill="#175d96"><path d="M10 3.3c-.6 0-1 .4-1.1 1.1v11.2c0 .3.2.6.4.8s.5.4.8.4c.6 0 1-.4 1.1-1.1V4.5c0-.3-.2-.6-.4-.8s-.5-.4-.8-.4z"></path></svg><a class="sidebar-item__title sidebar-link__print" href="/contribute/printable/" rel="nofollow noopener noreferrer" alt="Print" title="Print" target="_blank">Print Section<img src="/icon-print.d4d2cfa27f8b9a98e34a.svg" width="27" height="20" alt="Printer Icon"/></a></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/contribute/">参与贡献</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="开发人员 "><a aria-current="page" class="active" href="/contribute/#developers">开发人员 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="我如何帮助 webpack？ "><a aria-current="page" class="active" href="/contribute/#how-can-i-help">我如何帮助 webpack？ </a></li><li class="sidebar-item__anchor" title="要求雇主使用 webpack "><a aria-current="page" class="active" href="/contribute/#encouraging-employers">要求雇主使用 webpack </a></li><li class="sidebar-item__anchor" title="贡献代码 "><a aria-current="page" class="active" href="/contribute/#your-contributions">贡献代码 </a></li></ul></li><li class="sidebar-item__anchor" title="管理人员 "><a aria-current="page" class="active" href="/contribute/#executives">管理人员 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="赞助 "><a aria-current="page" class="active" href="/contribute/#sponsorship">赞助 </a></li><li class="sidebar-item__anchor" title="其他人群 "><a aria-current="page" class="active" href="/contribute/#anyone-else">其他人群 </a></li></ul></li><li class="sidebar-item__anchor" title="拉取请求(pull requests) "><a aria-current="page" class="active" href="/contribute/#pull-requests">拉取请求(pull requests) </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/contribute/writers-guide/">作者指引</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="步骤 "><a class="" href="/contribute/writers-guide/#process">步骤 </a></li><li class="sidebar-item__anchor" title="YAML 文件顶部信息 "><a class="" href="/contribute/writers-guide/#yaml-frontmatter">YAML 文件顶部信息 </a></li><li class="sidebar-item__anchor" title="文章结构 "><a class="" href="/contribute/writers-guide/#article-structure">文章结构 </a></li><li class="sidebar-item__anchor" title="排版 "><a class="" href="/contribute/writers-guide/#typesetting">排版 </a></li><li class="sidebar-item__anchor" title="格式化 "><a class="" href="/contribute/writers-guide/#formatting">格式化 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="代码 "><a class="" href="/contribute/writers-guide/#code">代码 </a></li><li class="sidebar-item__anchor" title="列表 "><a class="" href="/contribute/writers-guide/#lists">列表 </a></li><li class="sidebar-item__anchor" title="表格 "><a class="" href="/contribute/writers-guide/#tables">表格 </a></li><li class="sidebar-item__anchor" title="配置属性 "><a class="" href="/contribute/writers-guide/#configuration-properties">配置属性 </a></li><li class="sidebar-item__anchor" title="引用 "><a class="" href="/contribute/writers-guide/#quotes">引用 </a></li><li class="sidebar-item__anchor" title="假设与详略 "><a class="" href="/contribute/writers-guide/#assumptions-and-simplicity">假设与详略 </a></li><li class="sidebar-item__anchor" title="配置的默认值和类型 "><a class="" href="/contribute/writers-guide/#configuration-defaults-and-types">配置的默认值和类型 </a></li><li class="sidebar-item__anchor" title="选项 shortlist 及其类型 "><a class="" href="/contribute/writers-guide/#options-shortlists-and-their-typing">选项 shortlist 及其类型 </a></li><li class="sidebar-item__anchor" title="添加链接 "><a class="" href="/contribute/writers-guide/#adding-links">添加链接 </a></li></ul></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/contribute/writing-a-loader/">编写 loader</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="设置 "><a class="" href="/contribute/writing-a-loader/#setup">设置 </a></li><li class="sidebar-item__anchor" title="简单用法 "><a class="" href="/contribute/writing-a-loader/#simple-usage">简单用法 </a></li><li class="sidebar-item__anchor" title="复杂用法 "><a class="" href="/contribute/writing-a-loader/#complex-usage">复杂用法 </a></li><li class="sidebar-item__anchor" title="用法准则(Guidelines) "><a class="" href="/contribute/writing-a-loader/#guidelines">用法准则(Guidelines) </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="简单(simple) "><a class="" href="/contribute/writing-a-loader/#simple">简单(simple) </a></li><li class="sidebar-item__anchor" title="链式(chaining) "><a class="" href="/contribute/writing-a-loader/#chaining">链式(chaining) </a></li><li class="sidebar-item__anchor" title="模块化(modular) "><a class="" href="/contribute/writing-a-loader/#modular">模块化(modular) </a></li><li class="sidebar-item__anchor" title="无状态(stateless) "><a class="" href="/contribute/writing-a-loader/#stateless">无状态(stateless) </a></li><li class="sidebar-item__anchor" title="loader 工具库(Loader Utilities) "><a class="" href="/contribute/writing-a-loader/#loader-utilities">loader 工具库(Loader Utilities) </a></li><li class="sidebar-item__anchor" title="loader 依赖(loader dependencies) "><a class="" href="/contribute/writing-a-loader/#loader-dependencies">loader 依赖(loader dependencies) </a></li><li class="sidebar-item__anchor" title="模块依赖(module dependencies) "><a class="" href="/contribute/writing-a-loader/#module-dependencies">模块依赖(module dependencies) </a></li><li class="sidebar-item__anchor" title="通用代码(common code) "><a class="" href="/contribute/writing-a-loader/#common-code">通用代码(common code) </a></li><li class="sidebar-item__anchor" title="绝对路径(absolute paths) "><a class="" href="/contribute/writing-a-loader/#absolute-paths">绝对路径(absolute paths) </a></li><li class="sidebar-item__anchor" title="同等依赖(peer dependencies) "><a class="" href="/contribute/writing-a-loader/#peer-dependencies">同等依赖(peer dependencies) </a></li></ul></li><li class="sidebar-item__anchor" title="测试 "><a class="" href="/contribute/writing-a-loader/#testing">测试 </a></li></ul></div></div><div><div class="sidebar-item sidebar-item--open "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a aria-current="page" class="sidebar-item__title active" href="/contribute/writing-a-plugin/">自定义插件</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="创建插件 "><a aria-current="page" class="active" href="/contribute/writing-a-plugin/#creating-a-plugin">创建插件 </a></li><li class="sidebar-item__anchor" title="基本插件架构 "><a aria-current="page" class="active" href="/contribute/writing-a-plugin/#basic-plugin-architecture">基本插件架构 </a></li><li class="sidebar-item__anchor" title="Compiler 和 Compilation "><a aria-current="page" class="active" href="/contribute/writing-a-plugin/#compiler-and-compilation">Compiler 和 Compilation </a></li><li class="sidebar-item__anchor" title="异步编译插件 "><a aria-current="page" class="active" href="/contribute/writing-a-plugin/#async-event-hooks">异步编译插件 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="tapAsync "><a aria-current="page" class="active" href="/contribute/writing-a-plugin/#tapasync">tapAsync </a></li></ul></li><li class="sidebar-item__anchor" title="示例 "><a aria-current="page" class="active" href="/contribute/writing-a-plugin/#example">示例 </a></li><li class="sidebar-item__anchor" title="插件的不同类型 "><a aria-current="page" class="active" href="/contribute/writing-a-plugin/#different-plugin-shapes">插件的不同类型 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="Synchronous(同步) Hooks "><a aria-current="page" class="active" href="/contribute/writing-a-plugin/#synchronous-hooks">Synchronous(同步) Hooks </a></li><li class="sidebar-item__anchor" title="Asynchronous(异步) Hooks "><a aria-current="page" class="active" href="/contribute/writing-a-plugin/#asynchronous-hooks">Asynchronous(异步) Hooks </a></li><li class="sidebar-item__anchor" title="默认配置 "><a aria-current="page" class="active" href="/contribute/writing-a-plugin/#configuration-defaults">默认配置 </a></li></ul></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/contribute/plugin-patterns/">插件模式</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="检索遍历资源、chunk、模块和依赖 "><a class="" href="/contribute/plugin-patterns/#exploring-assets-chunks-modules-and-dependencies">检索遍历资源、chunk、模块和依赖 </a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="监听观察图的修改 "><a class="" href="/contribute/plugin-patterns/#monitoring-the-watch-graph">监听观察图的修改 </a></li></ul></li><li class="sidebar-item__anchor" title="监听 chunk 的修改 "><a class="" href="/contribute/plugin-patterns/#changed-chunks">监听 chunk 的修改 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/contribute/release-process/">发布流程</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="拉取请求（pull request） "><a class="" href="/contribute/release-process/#pull-requests">拉取请求（pull request） </a></li><li class="sidebar-item__anchor" title="发布 "><a class="" href="/contribute/release-process/#releasing">发布 </a></li></ul></div></div><div><div class="sidebar-item  "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="15" height="17" fill="#175d96" class="sidebar-item__toggle"><path d="m9.2 4.5 4.5 4.7c.2.2.3.5.3.8s-.1.6-.3.8l-4.5 4.7c-.5.4-1.2.4-1.7 0-.4-.5-.4-1 0-1.6l3.8-3.9-3.8-4c-.4-.4-.4-1 0-1.5.5-.4 1.2-.4 1.7 0"></path></svg><a class="sidebar-item__title" href="/contribute/debugging/">调试</a><ul class="sidebar-item__anchors"><li class="sidebar-item__anchor" title="Stats "><a class="" href="/contribute/debugging/#stats">Stats </a></li><li class="sidebar-item__anchor" title="DevTools "><a class="" href="/contribute/debugging/#devtools">DevTools </a></li></ul></div></div></div></nav><section class="page"><div class="markdown"><h1>自定义插件</h1><div id="md-content"><p>插件向第三方开发者提供了 webpack 引擎中完整的能力。使用阶段式的构建回调，开发者可以在 webpack 构建流程中引入自定义的行为。创建插件比创建 loader 更加高级，因为你需要理解 webpack 底层的特性来处理相应的钩子，所以请做好阅读源码的准备！</p><h2><span id="creating-a-plugin"></span>创建插件<a href="#creating-a-plugin" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>webpack 插件由以下组成：</p><ul><li>一个 JavaScript 命名函数或 JavaScript 类。</li><li>在插件函数的 prototype 上定义一个 <code>apply</code> 方法。</li><li>指定一个绑定到 webpack 自身的<a href="/api/compiler-hooks/">事件钩子</a>。</li><li>处理 webpack 内部实例的特定数据。</li><li>功能完成后调用 webpack 提供的回调。</li></ul><pre><code class="hljs language-javascript"><span class="token comment">// 一个 JavaScript 类</span>
<span class="token keyword">class</span> <span class="token class-name">MyExampleWebpackPlugin</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在插件函数的 prototype 上定义一个 `apply` 方法，以 compiler 为参数。</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 指定一个挂载到 webpack 自身的事件钩子。</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span>
      <span class="token string">&#x27;MyExampleWebpackPlugin&#x27;</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;这是一个示例插件！&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
          <span class="token string">&#x27;这里表示了资源的单次构建的 `compilation` 对象：&#x27;</span><span class="token punctuation">,</span>
          compilation
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 用 webpack 提供的插件 API 处理构建过程</span>
        compilation<span class="token punctuation">.</span><span class="token function">addModule</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h2><span id="basic-plugin-architecture"></span>基本插件架构<a href="#basic-plugin-architecture" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>插件是由「具有 <code>apply</code> 方法的 prototype 对象」所实例化出来的。这个 <code>apply</code> 方法在安装插件时，会被 webpack compiler 调用一次。<code>apply</code> 方法可以接收一个 webpack compiler 对象的引用，从而可以在回调函数中访问到 compiler 对象。一个插件结构如下：</p><pre><code class="hljs language-javascript"><span class="token keyword">class</span> <span class="token class-name">HelloWorldPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>
      <span class="token string">&#x27;Hello World Plugin&#x27;</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>
        stats <span class="token comment">/* 绑定 done 钩子后，stats 会作为参数传入。 */</span>
      <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Hello World!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> HelloWorldPlugin<span class="token punctuation">;</span></code></pre><p>然后，要安装这个插件，只需要在你的 webpack 配置的 plugin 数组中添加一个实例：</p><pre><code class="hljs language-javascript"><span class="token comment">// webpack.config.js</span>
<span class="token keyword">var</span> HelloWorldPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;hello-world&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 这里是其他配置 ...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HelloWorldPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> options<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>使用 <a href="https://github.com/webpack/schema-utils"><code>schema-utils</code></a> 来校验传入插件的选项。这里是个例子：</p><pre><code class="hljs language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> validate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;schema-utils&#x27;</span><span class="token punctuation">;</span>

<span class="token comment">// 选项对象的 schema</span>
<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&#x27;object&#x27;</span><span class="token punctuation">,</span>
  properties<span class="token operator">:</span> <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&#x27;string&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">validate</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&#x27;Hello World Plugin&#x27;</span><span class="token punctuation">,</span>
      baseDataPath<span class="token operator">:</span> <span class="token string">&#x27;options&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h2><span id="compiler-and-compilation"></span>Compiler 和 Compilation<a href="#compiler-and-compilation" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>在插件开发中最重要的两个资源就是 <a href="/api/node/#compiler-instance"><code>compiler</code></a> 和 <a href="/api/compilation-hooks/"><code>compilation</code></a> 对象。理解它们的角色是扩展 webpack 引擎重要的第一步。</p><pre><code class="hljs language-javascript"><span class="token keyword">class</span> <span class="token class-name">HelloCompilationPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 指定一个挂载到 compilation 的钩子，回调函数的参数为 compilation 。</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#x27;HelloCompilationPlugin&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 现在可以通过 compilation 对象绑定各种钩子</span>
      compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#x27;HelloCompilationPlugin&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;资源已经优化完毕。&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> HelloCompilationPlugin<span class="token punctuation">;</span></code></pre><p><code>compiler</code> 和 <code>compilation</code> 以及其他重要对象提供的钩子清单，请查看 <a href="/api/plugins/">plugins API</a> 文档。</p><h2><span id="async-event-hooks"></span>异步编译插件<a href="#async-event-hooks" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>有些插件钩子是异步的。我们可以像同步方式一样用 <code>tap</code> 方法来绑定，也可以用 <code>tapAsync</code> 或 <code>tapPromise</code> 这两个异步方法来绑定。</p><h3><span id="tapasync"></span>tapAsync<a href="#tapasync" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>当我们用 <code>tapAsync</code> 方法来绑定插件时，_必须_调用函数的最后一个参数 <code>callback</code> 指定的回调函数。</p><pre><code class="hljs language-javascript"><span class="token keyword">class</span> <span class="token class-name">HelloAsyncPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span>
      <span class="token string">&#x27;HelloAsyncPlugin&#x27;</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 执行某些异步操作...</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;异步任务完成...&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> HelloAsyncPlugin<span class="token punctuation">;</span></code></pre><h4><span id="tappromise"></span>tapPromise<a href="#tappromise" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h4><p>当我们用 <code>tapPromise</code> 方法来绑定插件时，_必须_返回一个 pormise ，异步任务完成后 resolve 。</p><pre><code class="hljs language-javascript"><span class="token keyword">class</span> <span class="token class-name">HelloAsyncPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">&#x27;HelloAsyncPlugin&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 返回一个 pormise ，异步任务完成后 resolve</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;异步任务完成...&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> HelloAsyncPlugin<span class="token punctuation">;</span></code></pre><h2><span id="example"></span>示例<a href="#example" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>一旦我们可以深入理解 webpack compiler 和每个独立的 compilation，我们依赖 webpack 引擎将有无限多的事可以做。我们可以重新格式化已有的文件，创建衍生的文件，或者制作全新的生成文件。</p><p>让我们来写一个简单的示例插件，生成一个叫做 <code>assets.md</code> 的新文件；文件内容是所有构建生成的文件的列表。这个插件大概像下面这样：</p><pre><code class="hljs language-javascript"><span class="token keyword">class</span> <span class="token class-name">FileListPlugin</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> defaultOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    outputFile<span class="token operator">:</span> <span class="token string">&#x27;assets.md&#x27;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// 需要传入自定义插件构造函数的任意选项</span>
  <span class="token comment">//（这是自定义插件的公开API）</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在应用默认选项前，先应用用户指定选项</span>
    <span class="token comment">// 合并后的选项暴露给插件方法</span>
    <span class="token comment">// 记得在这里校验所有选项</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>FileListPlugin<span class="token punctuation">.</span>defaultOptions<span class="token punctuation">,</span> <span class="token operator">...</span>options <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pluginName <span class="token operator">=</span> FileListPlugin<span class="token punctuation">.</span>name<span class="token punctuation">;</span>

    <span class="token comment">// webpack 模块实例，可以通过 compiler 对象访问，</span>
    <span class="token comment">// 这样确保使用的是模块的正确版本</span>
    <span class="token comment">// （不要直接 require/import webpack）</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> webpack <span class="token punctuation">}</span> <span class="token operator">=</span> compiler<span class="token punctuation">;</span>

    <span class="token comment">// Compilation 对象提供了对一些有用常量的访问。</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> Compilation <span class="token punctuation">}</span> <span class="token operator">=</span> webpack<span class="token punctuation">;</span>

    <span class="token comment">// RawSource 是其中一种 “源码”(&quot;sources&quot;) 类型，</span>
    <span class="token comment">// 用来在 compilation 中表示资源的源码</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> RawSource <span class="token punctuation">}</span> <span class="token operator">=</span> webpack<span class="token punctuation">.</span>sources<span class="token punctuation">;</span>

    <span class="token comment">// 绑定到 “thisCompilation” 钩子，</span>
    <span class="token comment">// 以便进一步绑定到 compilation 过程更早期的阶段</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>thisCompilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>pluginName<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 绑定到资源处理流水线(assets processing pipeline)</span>
      compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>processAssets<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> pluginName<span class="token punctuation">,</span>

          <span class="token comment">// 用某个靠后的资源处理阶段，</span>
          <span class="token comment">// 确保所有资源已被插件添加到 compilation</span>
          stage<span class="token operator">:</span> Compilation<span class="token punctuation">.</span><span class="token constant">PROCESS_ASSETS_STAGE_SUMMARIZE</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token parameter">assets</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// &quot;assets&quot; 是一个包含 compilation 中所有资源(assets)的对象。</span>
          <span class="token comment">// 该对象的键是资源的路径，</span>
          <span class="token comment">// 值是文件的源码</span>

          <span class="token comment">// 遍历所有资源，</span>
          <span class="token comment">// 生成 Markdown 文件的内容</span>
          <span class="token keyword">const</span> content <span class="token operator">=</span>
            <span class="token string">&#x27;# In this build:\n\n&#x27;</span> <span class="token operator">+</span>
            Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>assets<span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#x27;\n&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// 向 compilation 添加新的资源，</span>
          <span class="token comment">// 这样 webpack 就会自动生成并输出到 output 目录</span>
          compilation<span class="token punctuation">.</span><span class="token function">emitAsset</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>outputFile<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">RawSource</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> FileListPlugin <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><strong>webpack.config.js</strong></p><pre><code class="hljs language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> FileListPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./file-list-plugin.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在 webpack 配置中使用自定义的插件：</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// …</span>

  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 添加插件，使用默认选项</span>
    <span class="token keyword">new</span> <span class="token class-name">FileListPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// 或者:</span>

    <span class="token comment">// 使用任意支持的选项</span>
    <span class="token keyword">new</span> <span class="token class-name">FileListPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      outputFile<span class="token operator">:</span> <span class="token string">&#x27;my-assets.md&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>这样就生成了一个制定名称的 markdown 文件：</p><pre><code class="hljs language-markdown"># In this build:

- main.css
- main.js
- index.html
</code></pre><aside class="tip"><h6 class="tip__prefix">提示</h6><p>我们使用 <code>tap()</code> 方法来绑定 <code>processAssets</code> 钩子，是因为上例中不需要执行任何异步操作。不过 <code>processAssets</code> 钩子是一个异步钩子，因此需要的时候也可用 <code>tapPromise()</code> 或 <code>tapAsync()</code> 方法。</p></aside><aside class="tip"><h6 class="tip__prefix">提示</h6><p><a href="/api/compilation-hooks/#processassets"><code>processAssets</code></a> 钩子还支持 <code>additionalAssets</code> 属性，不仅支持自定义插件拦截其他插件在当前阶段之前添加的资源，还支持当前阶段之后添加的资源。这样可以拦截 compilation 中的所有资源。不过这个例子在 <code>SUMMARIZE</code> 阶段捕获之前阶段生成的所有资源就够了（因为这些资源就是所有的了）。</p></aside><h2><span id="different-plugin-shapes"></span>插件的不同类型<a href="#different-plugin-shapes" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h2><p>webpack 插件可以按照它所注册的事件分成不同的类型。每一个事件钩子都预先定义为同步、异步、瀑布或并行钩子，钩子在内部用 call/callAsync 方法调用。支持的钩子清单或可被绑定的钩子清单，通常在 <code>this.hooks</code> 属性指定。</p><p>例如:</p><pre><code class="hljs language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
  shouldEmit<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncBailHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;compilation&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>表示唯一支持的钩子是 <code>shouldEmit</code> ，这是一个 <code>SyncBailHook</code> 类型的钩子，传入插件的唯一参数是 <code>compilation</code> 。</p><p>支持的各类型钩子：</p><h3><span id="synchronous-hooks"></span>Synchronous(同步) Hooks<a href="#synchronous-hooks" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><ul><li><p><strong>SyncHook</strong></p><ul><li>通过 <code>new SyncHook([params])</code> 定义。</li><li>用 <code>tap</code> 方法绑定。</li><li>用 <code>call(...params)</code> 方法调用。</li></ul></li><li><p><strong>Bail(保险) Hooks</strong></p><ul><li>通过 <code>new SyncBailHook([params])</code> 定义。</li><li>用 <code>tap</code> 方法绑定。</li><li>用 <code>call(...params)</code> 方法调用。</li></ul><p>Bail类型的钩子，其插件回调函数是串行调用，任意一个插件回调函数返回非 undefined 值，则停止执行插件，该值作为钩子的返回值。<code>optimizeChunks</code>，<code>optimizeChunkModules</code> 等很有用的事件都是 SyncBailHooks 。</p></li><li><p><strong>Waterfall(瀑布) Hooks</strong></p><ul><li>通过 <code>new SyncWaterfallHook([params])</code> 定义。</li><li>用 <code>tap</code> 方法绑定。</li><li>用 <code>call(...params)</code> 方法调用。</li></ul><p>该类型的插件是一个接一个串行执行，前一个的返回值作为后一个的入参。插件需要考虑执行的顺序，因为后一个插件必须接受前一个插件执行的结果作为入参。第一个插件的参数为 <code>init</code> 。
所以 waterfall 钩子至少要制定一个参数。这种模式用于和 <code>ModuleTemplate</code>，<code>ChunkTemplate</code> 等 webpack 模板相关的 Tapable 实例。</p></li></ul><h3><span id="asynchronous-hooks"></span>Asynchronous(异步) Hooks<a href="#asynchronous-hooks" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><ul><li><p><strong>Async Series(异步串联) Hook</strong></p><ul><li>通过 <code>new AsyncSeriesHook([params])</code> 定义。</li><li>用 <code>tap</code>/<code>tapAsync</code>/<code>tapPromise</code> 方法绑定。</li><li>用 <code>callAsync(...params)</code> 方法调用。</li></ul><p>插件处理函数(handler functions)的参数为所有参数，以及一个签名为 <code>(err?: Error) -&gt; void</code> 的 callback 函数，callback 函数的处理函数按注册顺序执行。<code>callback</code> 在所有处理函数执行完后调用。
这是 <code>emit</code> 和 <code>run</code> 事件的常见使用模式。</p></li><li><p><strong>Async waterfall(异步瀑布)</strong> 插件会用 waterfall 方式异步应用</p><ul><li>通过 <code>new AsyncWaterfallHook([params])</code> 定义。</li><li>用 <code>tap</code>/<code>tapAsync</code>/<code>tapPromise</code> 方法绑定。</li><li>用 <code>callAsync(...params)</code> 方法调用。</li></ul><p>插件处理函数的参数为当前值，以及一个签名为 <code>(err: Error, nextValue: any) -&gt; void</code> 的 callback 函数。调用时 <code>nextValue</code> 是下一个处理函数的当前值。第一个处理函数的当前是只 <code>init</code> 。当所有 handler 都执行后，callback执行，参数为最后一个值。任一个 handler 传入 <code>err</code> 值，停止调用 handler 且 callback 被调用。
这种模式在 <code>before-resolve</code> 和 <code>after-resolve</code> 事件中常见。</p></li><li><p><strong>Async Series Bail</strong></p><ul><li>通过 <code>new AsyncSeriesBailHook([params])</code> 定义。</li><li>用 <code>tap</code>/<code>tapAsync</code>/<code>tapPromise</code> 方法绑定。</li><li>用 <code>callAsync(...params)</code> 方法调用。</li></ul></li><li><p><strong>Async Parallel</strong></p><ul><li>通过 <code>new AsyncParallelHook([params])</code> 定义。</li><li>用 <code>tap</code>/<code>tapAsync</code>/<code>tapPromise</code> 方法绑定。</li><li>用 <code>callAsync(...params)</code> 方法调用。</li></ul></li></ul><h3><span id="configuration-defaults"></span>默认配置<a href="#configuration-defaults" aria-hidden="true" tabindex="-1"><span class="header-link"></span></a></h3><p>Webpack 先应用插件的默认配置，再应用自身的默认配置。这样可以让插件拥有自己的默认配置，同时支持实现创建预设配置的插件。</p></div><div class="print:hidden mt-20"><a class="text-gray-500 dark:text-gray-500 text-sm cursor-pointer font-sans hover:underline" href="https://github.com/docschina/webpack.js.org/edit/cn/src/content/contribute/writing-a-plugin.mdx">编辑此页</a><span class="mx-5 text-black font-bold dark:text-white">·</span><a class="text-gray-500 dark:text-gray-500 text-sm cursor-pointer font-sans hover:underline">打印文档</a></div><div class="adjacent-links print:hidden"><div class="adjacent-links__prev"><div>« Previous</div><a class="adjacent-links__link" href="/contribute/writing-a-loader/">编写 loader</a></div><div class="adjacent-links__next"><div class="adjacent-links__label--next">Next »</div><a class="adjacent-links__link" href="/contribute/plugin-patterns/">插件模式</a></div></div><div class="contributors__section"><h3 class="!font-sans !font-normal">1<!-- --> <!-- -->位译者</h3><div class="translators"><div class="translators__list"><a class="translator" href="https://github.com/jsbugwang"><img alt="jsbugwang" src="/icon-square-small-slack.9281492bb267314634b4.png"/><span class="translator__name"> <!-- -->jsbugwang</span></a></div></div></div><div data-testid="contributors" class="print:hidden"><h2 class="!font-sans !font-normal">10<!-- --> <!-- -->位贡献者</h2><div><div class="grid gap-[10px] lg:gap-[15px] grid-cols-contributors"><a href="https://github.com/slavafomin"><img width="45" height="45" alt="slavafomin" title="slavafomin" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/tbroadley"><img width="45" height="45" alt="tbroadley" title="tbroadley" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/nveenjain"><img width="45" height="45" alt="nveenjain" title="nveenjain" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/iamakulov"><img width="45" height="45" alt="iamakulov" title="iamakulov" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/byzyk"><img width="45" height="45" alt="byzyk" title="byzyk" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/franjohn21"><img width="45" height="45" alt="franjohn21" title="franjohn21" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/EugeneHlushko"><img width="45" height="45" alt="EugeneHlushko" title="EugeneHlushko" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/snitin315"><img width="45" height="45" alt="snitin315" title="snitin315" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/rahul3v"><img width="45" height="45" alt="rahul3v" title="rahul3v" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a><a href="https://github.com/jamesgeorge007"><img width="45" height="45" alt="jamesgeorge007" title="jamesgeorge007" class="w-full rounded-full shadow" src="/icon-square-small-slack.9281492bb267314634b4.png"/></a></div></div></div></div></section></div><footer class="footer"><div class="container footer__inner"><section class="footer__left"><a class="footer__link" href="/guides/getting-started/">快速开始</a><a class="footer__link" href="/comparison/">对比</a><a href="https://privacy-policy.openjsf.org/" target="_blank" rel="noopener noreferrer" class="footer__link">Privacy Policy</a></section><section class="footer__middle"><a class="footer__icon" href="/"><img src="/icon-square-small.85ba630cf0c5f29ae3e3.svg" alt="webpack icon" width="35" height="35"/></a></section><section class="footer__right"><a href="https://webpack.threadless.com/" target="_blank" rel="noopener noreferrer" class="footer__link">周边</a><a class="footer__link" href="/awesome-webpack/">Awesome webpack</a><a class="footer__link" href="/glossary/">术语</a><a class="footer__link" href="/branding/">品牌</a><a href="https://gitter.im/webpack/webpack" target="_blank" rel="noopener noreferrer" class="footer__link">Gitter</a><a href="https://github.com/webpack/webpack/releases" target="_blank" rel="noopener noreferrer" class="footer__link">更新日志</a><a class="footer__link footer__license" href="/license"><img alt="Creative Commons License" src="/cc.ab77d813bf219c6e34ff.svg" width="25" height="25"/><img alt="Creative Commons License" src="/by.1360bb2e6d1fc28cdd9e.svg" width="25" height="25"/></a></section></div></footer></div></div><script src="/vendor.e63a9c1308a47f528841.js"></script><script src="/index.9021dfa1363de1c1e288.js"></script><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f92e0e48311f635665d2de225751a349";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script></body>